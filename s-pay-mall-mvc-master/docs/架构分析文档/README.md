# 项目架构分析文档

## 📋 文档导航

本文档目录包含了对 **s-pay-mall-mvc** 项目的全面架构分析，涵盖技术栈、目录结构、业务流程、数据库设计和API接口等核心内容。

---

## 📚 文档清单

### [01-技术栈清单.md](./01-技术栈清单.md)
**内容概要**:
- 后端技术栈（Spring Boot、MyBatis、支付宝SDK等）
- 数据库技术（MySQL 8.0）
- 开发工具链（Maven、Java 8）
- 第三方服务集成（微信、支付宝）
- 项目特性与架构模式

**适用场景**: 了解项目使用的技术和依赖版本

---

### [02-目录结构说明.md](./02-目录结构说明.md)
**内容概要**:
- Maven 多模块项目结构
- 各模块职责说明（common、domain、dao、service、web）
- 目录树状图
- 模块依赖关系
- 设计模式说明

**适用场景**: 理解项目组织结构和模块划分

---

### [03-业务流程时序图.md](./03-业务流程时序图.md)
**内容概要**:
- 支付下单流程（Mermaid 时序图）
- 支付回调流程
- 微信扫码登录流程
- 定时任务流程（超时关单、支付回调检测）
- 事件驱动流程
- 订单状态流转图

**适用场景**: 理解核心业务流程和系统交互

---

### [04-数据库设计.md](./04-数据库设计.md)
**内容概要**:
- 数据库基本信息
- pay_order 表结构设计
- 索引设计说明
- 订单状态枚举值
- 数据访问操作（SQL）
- 数据模型映射
- 性能优化建议

**适用场景**: 数据库设计和优化参考

---

### [05-API接口清单.md](./05-API接口清单.md)
**内容概要**:
- 接口概览和基础信息
- 支付宝支付接口（创建订单、支付回调）
- 微信登录接口（生成二维码、检查登录状态）
- 微信公众号回调接口
- 数据结构定义
- 接口调用示例
- 安全说明和错误处理

**适用场景**: API 开发和对接参考

---

## 🎯 项目概述

### 项目名称
**s-pay-mall-mvc** - 支付商城系统（MVC架构）

### 项目简介
基于 Spring Boot 的支付商城系统，集成了支付宝支付和微信登录功能，采用 Maven 多模块架构，实现了订单管理、支付处理、用户登录等核心业务。

### 核心功能
1. **订单管理**: 订单创建、状态管理、超时关闭
2. **支付集成**: 支付宝沙箱支付、支付回调处理
3. **用户登录**: 微信扫码登录
4. **定时任务**: 订单超时检测、支付回调补偿
5. **事件驱动**: 支付成功后的异步处理

### 技术特点
- ✅ Maven 多模块架构，职责分离清晰
- ✅ 统一响应格式和异常处理
- ✅ 定时任务支持订单状态补偿
- ✅ 事件总线实现业务解耦
- ✅ 支持多环境配置（dev/test/prod）

---

## 🏗️ 架构概览

### 分层架构

```
┌─────────────────────────────────────┐
│         Web Layer (Controller)      │  ← 接收HTTP请求
├─────────────────────────────────────┤
│      Service Layer (Business)       │  ← 业务逻辑处理
├─────────────────────────────────────┤
│       Dao Layer (Data Access)       │  ← 数据访问
├─────────────────────────────────────┤
│          Database (MySQL)          │  ← 数据存储
└─────────────────────────────────────┘
```

### 模块依赖

```
s-pay-mall-web
    ↓
s-pay-mall-service
    ↓
s-pay-mall-dao ─→ s-pay-mall-domain
    ↓                ↑
s-pay-mall-common ←──┘
```

---

## 📖 快速开始

### 1. 查看技术栈
→ [技术栈清单](./01-技术栈清单.md)

### 2. 了解项目结构
→ [目录结构说明](./02-目录结构说明.md)

### 3. 理解业务流程
→ [业务流程时序图](./03-业务流程时序图.md)

### 4. 查看数据库设计
→ [数据库设计](./04-数据库设计.md)

### 5. 查看API接口
→ [API接口清单](./05-API接口清单.md)

---

## 🔍 关键概念

### 订单状态
- **CREATE**: 订单创建完成
- **PAY_WAIT**: 等待支付
- **PAY_SUCCESS**: 支付成功
- **DEAL_DONE**: 交易完成
- **CLOSE**: 订单关闭

### 核心组件
- **OrderService**: 订单业务逻辑
- **AliPayController**: 支付宝支付接口
- **LoginService**: 微信登录服务
- **定时任务**: 订单超时关闭、支付回调检测
- **EventBus**: 事件发布订阅

---

## 🛠️ 开发建议

### 代码阅读顺序
1. 先看 **目录结构说明**，了解项目组织
2. 再看 **业务流程时序图**，理解核心流程
3. 查看 **数据库设计**，了解数据模型
4. 参考 **API接口清单**，进行接口开发
5. 对照 **技术栈清单**，了解技术选型

### 代码修改建议
- 修改业务逻辑：关注 Service 层
- 修改数据访问：关注 Dao 层和 MyBatis Mapper
- 添加新接口：在 Controller 层添加，调用 Service
- 修改数据库：更新 SQL 文件并同步 Domain 模型

---

## 📝 文档更新记录

| 日期 | 版本 | 更新内容 | 作者 |
|------|------|----------|------|
| 2024-12 | v1.0 | 初始版本，完成架构分析 | - |

---

## 🔗 相关资源

### 项目配置
- Maven 配置: `pom.xml`
- 应用配置: `application.yml`
- MyBatis 配置: `mybatis-config.xml`

### 部署文档
- Docker 配置: `docs/dev-ops/docker-compose-*.yml`
- Nginx 配置: `docs/release/nginx/`

### 第三方文档
- [支付宝沙箱文档](https://opendocs.alipay.com/common/02kkv7)
- [微信开放平台文档](https://developers.weixin.qq.com/doc/)

---

## 💡 提示

- 本文档基于代码静态分析生成，如有更新请及时同步文档
- 建议结合实际代码阅读，加深理解
- 如需扩展功能，请参考现有架构设计模式

---

**最后更新**: 2024-12
**文档版本**: v1.0

